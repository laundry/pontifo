window.d=document;window.ac=function(a,b){if(void 0==a.appendChild)throw"need appendChild";a.appendChild(b)};window.d.gebi=window.d.getElementById;window.intf={};void 0==window.history.pushState&&(window.history.pushState=function(){});window.rm=function(a){void 0!=a.remove?a.remove():a.parentNode.removeChild(a)};
window.ael=function(a,b,e){var c=null;a==window&&"load"==b&&(c="DOMContentLoaded");if(void 0!=a.addEventListener)null==c?a.addEventListener(b,e,!1):a.addEventListener(c,e,!1);else if(void 0!=a.attachEvent)a.attachEvent("on"+b,e);else if(null==a["on"+b])a["on"+b]=e;else if(null!=a["on"+b]){var f=a["on"+b];a["on"+b]=function(a){f(a);e(a)}}};window.preventDefault=function(a){void 0!=a.preventDefault?a.preventDefault():a.returnValue=!1};
intf.attachscore=function(a,b,e){if(b==e)intf.qobjs[a].score=10,intf.updatescore(a);else{intf.qobjs[a].computing=!0;var c=new XMLHttpRequest;c.onreadystatechange=function(){4==this.readyState&&(intf.qobjs[a].score=Math.round(11*Math.pow(.843,parseInt(this.responseText))-1),intf.updatescore(a))};c.open("GET","http://pontifo-svc.herokuapp.com/relation-score?one="+b+"&two="+e);c.send()}};intf.updatescore=function(a){for(var b=0,e=0;e<=a%10;e++)b+=intf.qobjs[a-e].score;d.gebi("scorer").innerHTML=b};
intf.newgame=function(){void 0==intf.qobjs&&(intf.qobjs=[]);var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(void 0==intf.qobjs&&(intf.qobjs=[]),intf.qobjs.push(JSON.parse(this.responseText)),intf.clears(),intf.showquestion(intf.qobjs.length-1))};a.open("GET",intf.urprefix+(intf.qobjs.length&&""==intf.urprefix?"/game/next_quote":"/game/new"));a.send()};intf.clears=function(){d.gebi("something").innerHTML=""};
intf.titlescreen=function(){d.gebi("something").innerHTML="<div class=titlescreen><h4>Welcome To</h4><h1>iPontof</h1></div><input id=restartbutton type=button onclick='intf.newgame()' value='Start Game'>";d.gebi("restartbutton").focus()};intf.startgame=function(){0<intf.qobjs.length?intf.showquestion(0):console.log("err")};intf.clearscores=function(){d.gebi("scorer").innerHTML="";d.gebi("status").innerHTML=""};
intf.showquestion=function(a){0==a%10&&intf.clearscores();var b=intf.qobjs[a],e=d.createElement("form"),c;c="<div class=minfo><div class=imgholder>";void 0!=b.movie_img_url&&/pontifo/.test(b.movie_img_url)&&(c+="<img src='"+b.movie_img_url+"'>");c+="<div class=from>"+b.from+"</div></div>";c+="<div class=imgholder>";void 0!=b.actor_img_url&&/pontifo/.test(b.actor_img_url)&&(c+="<img src='"+b.actor_img_url+"'>");c+="<div class=speaker>"+b.speaker+"</div>";c+="<div class=character>"+b.character+"</div>";
c+="</div></div><div class=question id='qid-"+a+"'>";for(var f=0;f<=b.tokens.length;f++){f==b.removed_index&&(c+="<input type=text name='replaced-q"+a+"'>");if(f==b.tokens.length)break;c+=b.tokens[f]+" "}c+="</div>";for(var g=[],f=0;f<g.length;f++)c+="<div class="+g[f]+">"+b[g[f]]+"</div>";c+="</div>";ael(e,"submit",function(a){return function(b){preventDefault(b);b=d.querySelector("input[name=replaced-q"+a+"]");intf.tryanswer(b.value,a)}}(a));e.className="questionall";e.id="qallid-"+a;e.innerHTML=
c;ac(intf.dloc,e);d.querySelector("input[name=replaced-q"+a+"]").focus();window.scrollTo(0,d.body.offsetHeight)};
intf.tryanswer=function(a,b){var e=intf.qobjs[b].removed_token.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),c=a.replace(/[^a-zA-Z0-9]/,""),c=c.toLowerCase(),f=d.createElement("div");f.className="congrats";var g="";intf.attachscore(b,c,e);if(c==e)f.innerText="Correct!",f.style.color="green",f.style.fontSize="100%",f.style.textTransform="uppercase",intf.qobjs[b].correct=!0;else{intf.qobjs[b].correct=!1;f.innerText="Wrong";f.style.color="red";f.style.fontSize="100%";f.style.textTransform="uppercase";c=
"";for(e=0;e<intf.qobjs[b].tokens.length;e++)e==intf.qobjs[b].removed_index&&(c+="<strong>"+intf.qobjs[b].removed_token+"</strong> "),c+=intf.qobjs[b].tokens[e]+" ";c=c.substring(0,c.length-1-1);g+="The real answer is <br>"+c+'<br>You put <strong>"'+a+'"</strong>'}d.gebi("status").innerHTML="";""!=g&&(e=d.createElement("div"),e.innerHTML=g,ac(d.gebi("status"),e));ac(d.gebi("status"),f);if(0==intf.qobjs.length%10){f=0;for(e=-9;1>e;e++)intf.qobjs[b+e].correct&&f++;g=d.createElement("form");ael(g,"submit",
intf.submitscore);g.id="subuname";g.innerHTML="<input id=uname placeholder='Your name' type=text>";e=d.createElement("input");e.type="button";e.value="Submit";ael(e,"click",intf.submitscore);ac(g,e);e=d.createElement("div");e.className="score";e.innerHTML="You got "+f+"/10 correct"+(10!=f?"<div class=comment>=C</div>":"");var h=d.createElement("input");h.id="restartbutton";ael(h,"click",function(){intf.newgame();rm(h)});h.type="button";h.value="Play Again?";ac(intf.dloc,e);ac(intf.dloc,g);ac(intf.dloc,
h);d.gebi("uname").focus()}else intf.newgame();rm(d.gebi("qallid-"+b))};
intf.submitscore=function(a){preventDefault(a);a=d.gebi("uname").value;var b=new XMLHttpRequest;b.open("GET",intf.urprefix+"/game/save?name="+a+"&score="+parseInt(d.gebi("scorer").innerHTML));a=d.gebi("subuname");var e=a.parentNode,c=a.nextSibling;b.onreadystatechange=function(){if(4==b.readyState){var a=d.createElement("div");a.className="leaderboard";a.innerHTML="";e.insertBefore(a,c);intf.fillleaderboard(a)}};b.send();d.gebi("restartbutton").focus();rm(a)};
intf.fillleaderboard=function(a){var b=new XMLHttpRequest;b.onreadystatechange=function(){if(4==this.readyState){for(var b="<div><div>Name</div><div>Score</div></div>",c=JSON.parse(this.responseText),f=0;f<c.length;f++)b+="<div><div>"+c[f].name+"</div><div>"+c[f].score+"</div></div>";a.innerHTML=b}};b.open("GET","/game/leaders");b.send()};
ael(window,"load",function(){if(void 0==window.JSON||void 0==d.querySelector)window.setTimeout(function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript";b.src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js";a.appendChild(b)},1E3),d.querySelector=function(a){return $(a)[0]},window.JSON={},window.JSON.parse=function(a){return $.parseJSON(a)};intf.urprefix="pontifo.herokuapp.com"!=window.location.host?"http://pontifo.herokuapp.com":
"";var a=d.createElement("h2");a.innerText="Pontifo!";intf.dloc=d.gebi("something");ac(d.gebi("persistent"),a);a=d.createElement("div");a.id="scorer";ac(d.gebi("persistent"),a);if("/"==window.location.pathname)intf.titlescreen();else if("/leaderboard"==window.location.pathname){a=d.createElement("div");a.className="leaderboard";a.innerHTML="";ac(intf.dloc,a);intf.fillleaderboard(a);var b=d.createElement("input");ael(b,"click",function(){history.pushState({state:"newgame"},null,"/");intf.newgame();
rm(b)});b.type="button";b.value="New Game";ac(intf.dloc,b);b.focus()}});
