window.d=document;window.ac=function(a,c){if(void 0==a.appendChild)throw"need appendChild";a.appendChild(c)};window.d.gebi=window.d.getElementById;window.intf={};void 0==window.history.pushState&&(window.history.pushState=function(){});window.rm=function(a){void 0!=a.remove?a.remove():a.parentNode.removeChild(a)};
window.ael=function(a,c,e){var b=null;a==window&&"load"==c&&(b="DOMContentLoaded");if(void 0!=a.addEventListener)null==b?a.addEventListener(c,e,!1):a.addEventListener(b,e,!1);else if(void 0!=a.attachEvent)a.attachEvent("on"+c,e);else if(null==a["on"+c])a["on"+c]=e;else if(null!=a["on"+c]){var f=a["on"+c];a["on"+c]=function(a){f(a);e(a)}}};window.preventDefault=function(a){void 0!=a.preventDefault?a.preventDefault():a.returnValue=!1};
intf.attachscore=function(a,c,e){if(c==e)intf.qobjs[a].score=10,intf.updatescore(a);else{intf.qobjs[a].computing=!0;var b=function(){if(4==this.readyState||void 0!=window.XDomainRequest)intf.qobjs[a].score=Math.round(11*Math.pow(.843,parseInt(this.responseText))-1),intf.updatescore(a)},f=null;void 0!=window.XDomainRequest?(f=new XDomainRequest,f.onload=b):(f=new XMLHttpRequest,f.onreadystatechange=b);f.open("GET","http://pontifo-svc.herokuapp.com/relation-score?one="+c+"&two="+e);f.send()}};
intf.updatescore=function(a){for(var c=0,e=0;e<=a%10;e++)void 0!=intf.qobjs[a-e].score&&(c+=intf.qobjs[a-e].score);d.gebi("scorer").innerHTML=c};
intf.newgame=function(){void 0==intf.qobjs&&(intf.qobjs=[]);var a=new XMLHttpRequest;a.onreadystatechange=function(){4==this.readyState&&(void 0==intf.qobjs&&(intf.qobjs=[]),intf.qobjs.push(JSON.altparse(this.responseText)),intf.clears(),intf.showquestion(intf.qobjs.length-1))};a.open("GET",intf.urprefix+(0==intf.qobjs.length%10||""!=intf.urprefix?"/game/new":"/game/next_quote"));a.send()};intf.clears=function(){d.gebi("something").innerHTML=""};
intf.titlescreen=function(){d.gebi("something").innerHTML="<div class=titlescreen><h4>Welcome To</h4><h1>iPontof</h1></div><input id=restartbutton type=button onclick='intf.newgame()' value='Start Game'>";d.gebi("restartbutton").focus()};intf.startgame=function(){0<intf.qobjs.length?intf.showquestion(0):console.log("err")};intf.clearscores=function(){d.gebi("scorer").innerHTML="";d.gebi("status").innerHTML=""};
intf.showquestion=function(a){0==a%10&&intf.clearscores();var c=intf.qobjs[a],e=d.createElement("form"),b;b="<div class=minfo><div class=imgholder>";void 0!=c.movie_img_url&&/pontifo/.test(c.movie_img_url)&&(b+="<img src='"+c.movie_img_url+"'>");b+="<div class=from>"+c.from+"</div></div>";b+="<div class=imgholder>";void 0!=c.actor_img_url&&/pontifo/.test(c.actor_img_url)&&(b+="<img src='"+c.actor_img_url+"'>");b+="<div class=speaker>"+c.speaker+"</div>";b+="<div class=character>"+c.character+"</div>";
b+="</div></div><div class=question id='qid-"+a+"'>";for(var f=0;f<=c.tokens.length;f++){f==c.removed_index&&(b+="<input type=text name='replaced-q"+a+"'>");if(f==c.tokens.length)break;b+=c.tokens[f]+" "}b+="</div>";for(var g=[],f=0;f<g.length;f++)b+="<div class="+g[f]+">"+c[g[f]]+"</div>";b+="</div>";ael(e,"submit",function(a){return function(b){preventDefault(b);b=dqs("input[name=replaced-q"+a+"]");intf.tryanswer(b.value,a)}}(a));e.className="questionall";e.id="qallid-"+a;e.innerHTML=b;ac(intf.dloc,
e);dqs("input[name=replaced-q"+a+"]").focus();window.scrollTo(0,d.body.offsetHeight)};
intf.tryanswer=function(a,c){var e=intf.qobjs[c].removed_token.toLowerCase().replace(/[^a-zA-Z0-9]/g,""),b=a.replace(/[^a-zA-Z0-9]/,""),b=b.toLowerCase(),f=d.createElement("div");f.className="congrats";var g="";intf.attachscore(c,b,e);if(b==e)f.innerText="Correct!",f.style.color="green",f.style.fontSize="100%",f.style.textTransform="uppercase",intf.qobjs[c].correct=!0;else{intf.qobjs[c].correct=!1;f.innerText="Wrong";f.style.color="red";f.style.fontSize="100%";f.style.textTransform="uppercase";b=
"";for(e=0;e<intf.qobjs[c].tokens.length;e++)e==intf.qobjs[c].removed_index&&(b+="<strong>"+intf.qobjs[c].removed_token+"</strong> "),b+=intf.qobjs[c].tokens[e]+" ";b=b.substring(0,b.length-1-1);g+="The real answer is <br>"+b+'<br>You put <strong>"'+a+'"</strong>'}d.gebi("status").innerHTML="";""!=g&&(e=d.createElement("div"),e.innerHTML=g,ac(d.gebi("status"),e));ac(d.gebi("status"),f);if(0==intf.qobjs.length%10){f=0;for(e=-9;1>e;e++)intf.qobjs[c+e].correct&&f++;g=d.createElement("form");ael(g,"submit",
intf.submitscore);g.id="subuname";g.innerHTML="<input id=uname placeholder='Your name' type=text>";e=d.createElement("input");e.type="button";e.value="Submit";ael(e,"click",intf.submitscore);ac(g,e);e=d.createElement("div");e.className="score";e.innerHTML="You got "+f+"/10 correct"+(10!=f?"<div class=comment>=C</div>":"");var h=d.createElement("input");h.id="restartbutton";ael(h,"click",function(){intf.newgame();rm(h)});h.type="button";h.value="Play Again?";ac(intf.dloc,e);ac(intf.dloc,g);ac(intf.dloc,
h);d.gebi("uname").focus()}else intf.newgame();rm(d.gebi("qallid-"+c))};
intf.submitscore=function(a){preventDefault(a);a=d.gebi("uname").value;var c=new XMLHttpRequest;c.open("GET",intf.urprefix+"/game/save?name="+a+"&score="+parseInt(d.gebi("scorer").innerHTML));a=d.gebi("subuname");var e=a.parentNode,b=a.nextSibling;c.onreadystatechange=function(){if(4==c.readyState){var a=d.createElement("div");a.className="leaderboard";a.innerHTML="";e.insertBefore(a,b);intf.fillleaderboard(a)}};c.send();d.gebi("restartbutton").focus();rm(a)};
intf.fillleaderboard=function(a){var c=new XMLHttpRequest;c.onreadystatechange=function(){if(4==this.readyState){for(var c="<div><div>Name</div><div>Score</div></div>",b=JSON.altparse(this.responseText),f=0;f<b.length;f++)c+="<div><div>"+b[f].name+"</div><div>"+b[f].score+"</div></div>";a.innerHTML=c}};c.open("GET","/game/leaders");c.send()};
ael(window,"load",function(){if(void 0==window.JSON||void 0==document.querySelector)window.setTimeout(function(){var a=document.getElementsByTagName("head")[0],b=document.createElement("script");b.type="text/javascript";b.src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js";a.appendChild(b)},1E3),window.dqs=function(a){return $(a)[0]},window.JSON={},window.JSON.altparse=function(a){var b=!1;try{b=$.parseJSON(a)}catch(c){b=!1}if(0!=b)return b;if(!/[;|=]/.test(a))try{eval("var temp="+
a+";")}catch(g){}return!1};void 0==window.dqs&&(window.dqs=function(a){return document.querySelector(a)});void 0==window.JSON.altparse&&(window.JSON.altparse=window.JSON.parse);intf.urprefix="pontifo.herokuapp.com"!=window.location.host?"http://pontifo.herokuapp.com":"";var a=d.createElement("h2");a.innerText="Pontifo!";intf.dloc=d.gebi("something");ac(d.gebi("persistent"),a);a=d.createElement("div");a.id="scorer";ac(d.gebi("persistent"),a);if("/"==window.location.pathname)intf.titlescreen();else if("/leaderboard"==
window.location.pathname){a=d.createElement("div");a.className="leaderboard";a.innerHTML="";ac(intf.dloc,a);intf.fillleaderboard(a);var c=d.createElement("input");ael(c,"click",function(){history.pushState({state:"newgame"},null,"/");intf.newgame();rm(c)});c.type="button";c.value="New Game";ac(intf.dloc,c);c.focus()}});
